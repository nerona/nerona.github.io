(function(a){a.fn.thooClock=function(b){this.each(function(){var v,w,d,q,C,j,s,B,A,i,m,l,h,f,r,o;q={size:250,dialColor:"#000000",dialBackgroundColor:"transparent",secondHandColor:"#F3A829",minuteHandColor:"#222222",hourHandColor:"#222222",alarmHandColor:"#FFFFFF",alarmHandTipColor:"#026729",hourCorrection:"+0",alarmCount:1,showNumerals:true};C=a.extend({},q,b);d=this;d.size=C.size;d.dialColor=C.dialColor;d.dialBackgroundColor=C.dialBackgroundColor;d.secondHandColor=C.secondHandColor;d.minuteHandColor=C.minuteHandColor;d.hourHandColor=C.hourHandColor;d.alarmHandColor=C.alarmHandColor;d.alarmHandTipColor=C.alarmHandTipColor;d.hourCorrection=C.hourCorrection;d.showNumerals=C.showNumerals;d.brandText=C.brandText;d.brandText2=C.brandText2;d.alarmCount=C.alarmCount;d.alarmTime=C.alarmTime;d.onAlarm=C.onAlarm;d.offAlarm=C.offAlarm;d.onEverySecond=C.onEverySecond;r=0;v=document.createElement("canvas");w=v.getContext("2d");v.width=this.size;v.height=this.size;a(v).appendTo(d);j=parseInt(d.size/2,10);w.translate(j,j);a.fn.thooClock.setAlarm=function(G){var F;if(G instanceof Date){F=G}else{var x=G.split(":");F=new Date();for(var y=0;y<3;y++){x[y]=Math.floor(x[y]);if(x[y]!==x[y]||x[y]>59){x[y]=0}if(y==0&&x[y]>23){x[y]=0}}F.setHours(x[0],x[1],x[2])}d.alarmTime=F};a.fn.thooClock.clearAlarm=function(){d.alarmTime=undefined;u(0,0);a(d).trigger("offAlarm")};function g(x){return(Math.PI/180)*x}function z(N,H){var J,G,P,U,y,M,L,K,R,Q,T,S,I,V,F,O,x;J=parseInt(j-(d.size/50),10);G=j-(d.size/400);w.beginPath();w.arc(0,0,G,0,360,false);w.fillStyle=H;w.fill();for(P=1;P<=60;P+=1){U=Math.PI/30*P;y=Math.sin(U);M=Math.cos(U);if(P%5===0){w.lineWidth=parseInt(d.size/50,10);L=y*(J-J/9);K=M*-(J-J/9);R=y*J;Q=M*-J;T=y*(J-J/4.2);S=M*-(J-J/4.2);I=P/5;w.textBaseline="middle";V=parseInt(d.size/13,10);w.font="100 "+V+"px helvetica";F=w.measureText(I).width;w.beginPath();w.fillStyle=N;if(d.showNumerals){w.fillText(I,T-(F/2),S)}}else{w.lineWidth=parseInt(d.size/100,10);L=y*(J-J/20);K=M*-(J-J/20);R=y*J;Q=M*-J}w.beginPath();w.strokeStyle=N;w.lineCap="round";w.moveTo(L,K);w.lineTo(R,Q);w.stroke()}if(d.brandText!==undefined){w.font="100 "+parseInt(d.size/28,10)+"px helvetica";O=w.measureText(d.brandText).width;w.fillText(d.brandText,-(O/2),(d.size/6))}if(d.brandText2!==undefined){w.textBaseline="middle";w.font="100 "+parseInt(d.size/44,10)+"px helvetica";x=w.measureText(d.brandText2).width;w.fillText(d.brandText2,-(x/2),(d.size/5))}}function D(x){if(x>=12){x=x-12}return x}function E(x){w.beginPath();w.moveTo(0,0);w.lineTo(0,x*-1);w.stroke()}function c(F,x){var y=(j)-(d.size/40);w.save();w.lineWidth=parseInt(d.size/150,10);w.lineCap="round";w.strokeStyle=x;w.rotate(g(F*6));w.shadowColor="rgba(0,0,0,.5)";w.shadowBlur=parseInt(d.size/80,10);w.shadowOffsetX=parseInt(d.size/200,10);w.shadowOffsetY=parseInt(d.size/200,10);E(y);w.beginPath();w.moveTo(0,0);w.lineTo(0,y/15);w.lineWidth=parseInt(d.size/30,10);w.stroke();w.beginPath();w.arc(0,0,parseInt(d.size/30,10),0,360,false);w.fillStyle=x;w.fill();w.restore()}function t(y,x){var F=d.size/2.2;w.save();w.lineWidth=parseInt(d.size/50,10);w.lineCap="round";w.strokeStyle=x;w.rotate(g(y*6));w.shadowColor="rgba(0,0,0,.5)";w.shadowBlur=parseInt(d.size/50,10);w.shadowOffsetX=parseInt(d.size/250,10);w.shadowOffsetY=parseInt(d.size/250,10);E(F);w.restore()}function k(x,y){var F=d.size/3;w.save();w.lineWidth=parseInt(d.size/25,10);w.lineCap="round";w.strokeStyle=y;w.rotate(g(x*30));w.shadowColor="rgba(0,0,0,.5)";w.shadowBlur=parseInt(d.size/50,10);w.shadowOffsetX=parseInt(d.size/300,10);w.shadowOffsetY=parseInt(d.size/300,10);E(F);w.restore()}function n(F){var y,x;if(F!==undefined){y=D(F.getHours());x=F.getMinutes()}return parseInt(y,10)+(x/60)}function p(G,x,y){var F=d.size/2.4;w.save();w.lineWidth=parseInt(d.size/30,10);w.lineCap="butt";w.strokeStyle=x;G=n(G);w.rotate(g(G*30));w.shadowColor="rgba(0,0,0,.5)";w.shadowBlur=parseInt(d.size/55,10);w.shadowOffsetX=parseInt(d.size/300,10);w.shadowOffsetY=parseInt(d.size/300,10);w.beginPath();w.moveTo(0,0);w.lineTo(0,(F-(d.size/10))*-1);w.stroke();w.beginPath();w.strokeStyle=y;w.moveTo(0,(F-(d.size/10))*-1);w.lineTo(0,(F)*-1);w.stroke();w.beginPath();w.arc(0,0,parseInt(d.size/24,10),0,360,false);w.fillStyle=x;w.fill();w.restore()}function e(x){if(x!=="+0"&&x!==""){if(x.charAt(0)==="+"){return +x.charAt(1)}else{return -x.charAt(1)}}else{return 0}}if(d.onAlarm!==undefined){a(d).on("onAlarm",function(x){d.onAlarm();x.preventDefault();x.stopPropagation()})}if(d.onEverySecond!==undefined){a(d).on("onEverySecond",function(x){d.onEverySecond();x.preventDefault()})}if(d.offAlarm!==undefined){a(d).on("offAlarm",function(x){d.offAlarm();x.stopPropagation();x.preventDefault()})}o=0;function u(M,L){var F,S,H,N,G,I,Q,J,R,P,O;F=new Date();S=F.getSeconds();G=F.getMinutes();H=G+(S/60);N=F.getHours();I=D(N+e(d.hourCorrection))+(H/60);w.clearRect(-j,-j,d.size,d.size);z(d.dialColor,d.dialBackgroundColor);if(d.alarmTime!==undefined){p(d.alarmTime,d.alarmHandColor,d.alarmHandTipColor)}k(I,d.hourHandColor);t(H,d.minuteHandColor);c(S,d.secondHandColor);L+=1;if(L===1){a(d).trigger("onEverySecond");L=0}if(d.alarmTime!==undefined){R=(d.alarmTime.getHours()*60*60)+(d.alarmTime.getMinutes()*60)+d.alarmTime.getSeconds()}P=(N*60*60)+(G*60)+S;if(P>=R){M+=1}if(M<=d.alarmCount&&M!==0){a(d).trigger("onAlarm")}var K=1000-((new Date().getTime())%1000);setTimeout(function(){u(M,L)},K)}u(r,o)})}}(jQuery));