<!doctype html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
    <title>HTML5 手机摇一摇</title>
</head>
<body>
<div>shake2------4</div>
<div id="text">0</div>

<script type="text/javascript">
    var SHAKE_THRESHOLD = 30;
    // 定义一个变量保存上次更新的时间
    var last_update = 0;
    // 紧接着定义x、y、z记录三个轴的数据以及上一次出发的时间
    var x;
    var y;
    var z;
    var last_x;
    var last_y;
    var last_z;
    var count = 0;
    var num = 0;
    var lastSpeed = 0;
    var timer;
    var color = new Array('#fff', '#ff0', '#f00', '#000', '#00f', '#0ff');

    if (window.DeviceMotionEvent) {
        // 移动浏览器支持运动传感事件
        window.addEventListener('devicemotion', deviceMotionHandler, false);
    } else {
        alert('您的设备不支持摇一摇哦');
    }
    function deviceMotionHandler(eventData) {
        // 获取含重力的加速度
        var acceleration = eventData.accelerationIncludingGravity;
        // 获取当前时间
        var curTime = new Date().getTime();
        var diffTime = curTime - last_update;
        // 固定时间段
        if (diffTime > 20) {
            last_update = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;

            //var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 30000;
            var speed = Math.sqrt(x * x + y * y + z * z);
            var ds = Math.abs(speed - lastSpeed);

            if (ds > SHAKE_THRESHOLD) {
                // TODO:在此处可以实现摇一摇之后所要进行的数据逻辑操作
                count++;
                document.getElementById('text').innerHTML = count;
                document.body.style.backgroundColor = color[Math.round(Math.random()*10)%6];
            }
            last_x = x;
            last_y = y;
            last_z = z;
            lastSpeed = speed;
        }
    }
</script>
</body>
</html>