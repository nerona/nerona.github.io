<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>活动地点</title>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.5,maximum-scale=0.65 , user-scalable=0">
    <base href="../../../"/>
    <link rel="stylesheet" href="css/common/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" href="css/style2.css"/>
    <link rel="stylesheet" href="http://cache.amap.com/lbs/static/main.css?v=1.0"/>
    <script type="text/javascript" src="http://cache.amap.com/lbs/static/PlaceSearchRender.js"></script>
    <script type="text/javascript"
            src="http://webapi.amap.com/maps?v=1.3&key=a26409513e53780ddc064cb3e26ed322&plugin=AMap.Autocomplete,AMap.PlaceSearch,AMap.Geocoder"></script>
    <style type="text/css">
        #mapContainer {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .contant-main {
            padding: 0;
            overflow: hidden;
        }

    </style>
</head>
<body>
<div data-role="page">
    <section data-role="header" data-theme="b" class="my-header" id="my-header">
        <a href="javascript:history.back();" data-rel="back" data-role="none" class="my-header-back-btn"></a>
        <h2>活动地点</h2>
    </section>
    <input type="text" id="tipinput" name="tipinput"/>
    <div data-role="content" role="main" class="contant-main">
        <div id="mapContainer"></div>
    </div>
</div>
</body>
</html>
<script src="js/common/jquery.min.js"></script>
<script src="js/common/common.js"></script>
<script>
    $(document).bind('mobileinit', function () {
        $.mobile.changePage.defaults.changeHash = false;
        $.mobile.hashListeningEnabled = false;
        $.mobile.pushStateEnabled = false;
    });
    //点击确认获取经纬度{地址，经度，纬度}
    function subimtBtn() {
        //alert(JSON.stringify(Util.Amap.getTargetPosition()));
    }

    var map = Util.Amap.initConfig({mapContainer: "mapContainer", tipinput: 'tipinput'}).init();
    $("#mapContainer").height($(window).height() - $("#mapContainer").offset().top);

    function geocoder() {
        var geocoder = new AMap.Geocoder({
            city: "全国", //城市，默认：“全国”
            radius: 1000 //范围，默认：500
        });
        //地理编码,返回地理编码结果
        geocoder.getLocation(Util.common.getParameter("address"), function (status, result) {
            if (status === 'complete' && result.info === 'OK') {
                geocoder_CallBack(result);
            } else {
                alert('请尝试输入完整地址查询');
            }
        });
    }
    function addMarker(i, d) {
        var marker = new AMap.Marker({
            map: map,
            position: [d.location.getLng(), d.location.getLat()]
        });
        var infoWindow = new AMap.InfoWindow({
            content: d.formattedAddress,
            offset: {x: 0, y: -30}
        });
        marker.on("mouseover", function (e) {
            infoWindow.open(map, marker.getPosition());
        });
    }
    //地理编码返回结果展示
    function geocoder_CallBack(data) {
        //地理编码结果数组
        var geocode = data.geocodes;
        for (var i = 0; i < geocode.length; i++) {
            //拼接输出html
            addMarker(i, geocode[i]);
        }
        map.setFitView();
    }
    geocoder();
</script>
<script src="js/common/jquery.mobile-1.4.5.min.js"></script>
