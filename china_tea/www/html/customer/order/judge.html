<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta charset="utf-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.5,maximum-scale=1.0 , user-scalable=0">
    <base href="../../../"/>
    <link rel="stylesheet" href="css/common/jquery.mobile-1.4.5.min.css"/>
    <link rel="stylesheet" href="css/style-final.css"/>
    <link rel="stylesheet" href="css/customer/order/judge.css"/>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
</head>
<body>
<div data-role="page" class="jqm-main" data-quicklinks="true">
    <section data-role="header" data-theme="b" class="my-header" id="my-header">
        <a href="javascript:history.back();" data-role="none" class="my-header-back-btn"></a>
        <h2>评价</h2>
        <a href="#" class="my-header-right-btn-ad" data-role="none"><span>.</span><span>.</span><span>.</span></a>
    </section>
    <input type="hidden" id="domain" value="http://o7o0uv2j1.bkt.clouddn.com/">
    <input type="hidden" id="uptoken_url" value="">
    <section data-role="content" role="main" data-theme="a" class="judge-main" id="judge-info">

    </section>
    <section data-role="footer" data-disable-page-zoom="false" data-tap-toggle="false" data-position="fixed"
             style="background-color: #ffffff;padding: 10px;position: fixed;">

        <a href="#" data-rel="popup" data-position-to="window" data-role="none" class="ok-order-btn-r">提交</a>

    </section>
</div>

<script type="text/javascript" src="js/common/jquery.min.js"></script>
<!--<script type="text/javascript" src="js/customer/order/qiniu/moxie.js"></script>
<script type="text/javascript" src="js/customer/order/qiniu/plupload.full.min.js"></script>-->

<!--<script type="text/javascript" src="js/customer/order/qiniu/ui.js" async></script>
<script type="text/javascript" src="js/customer/order/qiniu/qiniu.min.js" async></script>

<script type="text/javascript" src="js/customer/order/qiniu/main.js" async></script>-->

<script src="js/common/common.js"></script>
<!--<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>-->
<script src="js/common/jquery.mobile-1.4.5.min.js"></script>
<script src="js/common/jquery.tmpl.min.js"></script>
<script src="js/customer/order/judge.js"></script>
<!---->

<!---->
<script>
    $(document).bind('mobileinit', function () {
        $.mobile.changePage.defaults.changeHash = false;
        $.mobile.hashListeningEnabled = false;
        $.mobile.pushStateEnabled = false;
    });
    //add qiniu js
    window.onload = function(){
        /* var qiniu_js = document.createElement('script');
         qiniu_js.src = 'js/customer/order/qiniu/qiniu.min.js';
         var ui_js = document.createElement('script');
         ui_js.src = 'js/customer/order/qiniu/ui.js';
         var main_js = document.createElement('script');
         main_js.src = 'js/customer/order/qiniu/main.js';
         var head = document.getElementsByTagName('head')[0];
         head.appendChild(ui_js);
         head.appendChild(qiniu_js);
         head.appendChild(main_js);*/
        console.log(document.location.href);
        var url = Util.common.baseUrl + "/weixin/weixinConfig/verification.do";
        //var currentUrl = "weixinfront/html/customer/order/judge.html?goodModel=" + Util.common.getParameter('goodModel');
        var allUrl= document.location.href;
        //var xxUrl= allUrl.substring(34,allUrl.length);
        //var xxUrl= allUrl.substring(Util.common.baseUrl.length+1,allUrl.length);
        var xxUrl= "weixinfront/html/customer/order/judge.html?goodModel=%5B%7B%22goodSkuId%22%3A%22249240305922048001%22%2C%22goodImg%22%3A%22http%3A%2F%2Fo7o0uv2j1.bkt.clouddn.com%2F1464157541602420f274.jpg%22%2C%22goodName%22%3A%2299%E5%95%86%E5%8A%A1%C2%B7%E5%A4%A7%E7%BA%A2%E8%A2%8D%22%2C%22indentId%22%3A%22266538588631228416%22%7D%5D";
        var param = {"url":xxUrl};
        Util.common.executeAjaxCallback(url ,param,function(data){
            if(data.success){
                wx.config({
                    debug:false,
                    appId:data.msg.appId,
                    timestamp:data.msg.timestamp,
                    nonceStr:data.msg.nonceStr,
                    signature:data.msg.signature,
                    jsApiList: [
                        // 所有要调用的 API 都要加到这个列表中
                        'checkJsApi',
                        'chooseImage',
                        'uploadImage',
                        'downloadImage',
                        'previewImage'
                    ]
                });
                wx.ready(function () {
                    var images = {
                        localId: [],
                        serverId: [],
                        downloadId: []
                    };

                    document.querySelector('#add_img_1').onclick = function () {
                        wx.chooseImage({
                            count: 1, // 默认9
                            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                            success: function (res) {
                                images.localId = res.localIds;
                                jQuery(function(){
                                    $.each( res.localIds, function(i, n){
                                        $(".img-list-1").append('<img src="'+n+'" style="margin-right: 2%;"/>');
                                    });
                                });
                            }
                        });
                    };
                    document.querySelector('#add_img_2').onclick = function () {
                        wx.chooseImage({
                            count: 1, // 默认9
                            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                            success: function (res) {
                                images.localId = res.localIds;
                                jQuery(function(){
                                    $.each( res.localIds, function(i, n){
                                        $(".img-list-2").append('<img src="'+n+'" style="margin-right: 2%;"/>');
                                    });
                                });
                            }
                        });
                    };
                    document.querySelector('#add_img_3').onclick = function () {
                        wx.chooseImage({
                            count: 1, // 默认9
                            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                            success: function (res) {
                                images.localId = res.localIds;
                                jQuery(function(){
                                    $.each( res.localIds, function(i, n){
                                        $(".img-list-3").append('<img src="'+n+'" style="margin-right: 2%;"/>');
                                    });
                                });
                            }
                        });
                    };
                    document.querySelector('#add_img_4').onclick = function () {
                        wx.chooseImage({
                            count: 1, // 默认9
                            sizeType: ['original', 'compressed'], // 可以指定是原图还是压缩图，默认二者都有
                            sourceType: ['album', 'camera'], // 可以指定来源是相册还是相机，默认二者都有
                            success: function (res) {
                                images.localId = res.localIds;
                                jQuery(function(){
                                    $.each( res.localIds, function(i, n){
                                        $(".img-list-4").append('<img src="'+n+'" style="margin-right: 2%;"/>');
                                    });
                                });
                            }
                        });
                    };

                    document.querySelector('.ok-order-btn-r').onclick = function () {
                        if (images.localId.length == 0) {
                            alert('请先使用选择图片按钮');
                            return;
                        }
                        images.serverId = [];
                        jQuery(function(){
                            $.each(images.localId, function(i,n) {
                                wx.uploadImage({
                                    isShowProgressTips: 1, // 默认为1，显示进度提示
                                    localId: n,
                                    success: function (res) {
                                        images.serverId.push(res.serverId);
                                    },
                                    fail: function (res) {
                                        alert(JSON.stringify(res));
                                    }
                                });
                            });
                        });
                        customer.judge.submit();
                    };
                    wx.checkJsApi({
                        jsApiList: [ 'chooseImage', 'uploadImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
                        success: function(res) {
                            console.info(JSON.stringify(res));
                        },
                        fail: function(res) {
                            console.info(JSON.stringify(res));
                        }
                    });
                });

                wx.error(function (res) {
                    console.log(res.errMsg);
                });
            }
        });
    };
</script>


<script type="text/x-jquery-tmpl" id="good-info-t">
<dl class="judge-img-star" style="left: 8px">
            <dt><img  src="${goodImg}"></dt>
            <dd>
                <p style="margin-left: 4%;">${goodName}</p>
                <p class="pingfen">
                    <span class="score-text">评分:</span>
                    <span class="judge-main-score"><img src="images/hdpi/wddd_pj.png" index="0"><img src="images/hdpi/wddd_pj.png" index="1"><img src="images/hdpi/wddd_pj.png" index="2"><img src="images/hdpi/wddd_pj.png" index="3"><img src="images/hdpi/wddd_pj.png" index="4"></span>
                </p>
            </dd>
        </dl>
         <dl class="judge-content-dl">
            <input type="hidden" name="judge-content">
            <input type="hidden" name="judge-score">

            <dd>
                <p style="padding-left: 8px;">评价内容</p>
                <p><textarea cols="65" rows="3" data-role="none" placeholder="请输写下你对宝贝的评价吧~长度在1-500字" ></textarea></p>
                <div style="margin-left: 8px;position:relative" class="images-list-${num}">
                <img src="images/hdpi/wddd_pj_xj.png" class="add_img" id="add_img_${num}">
                </div>
            </dd>
        </dl>
    <div class="nm-judge-checkbox-div">
        <input type="checkbox" data-role="none" id="nm-judge-radio-${num}" class="ext-box-select"/><label for="nm-judge-radio-${num}">匿名评价</label>
    </div>
</script>
</body>
</html>